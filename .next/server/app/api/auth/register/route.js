"use strict";(()=>{var e={};e.id=2,e.ids=[2],e.modules={1185:e=>{e.exports=require("mongoose")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},4300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},2781:e=>{e.exports=require("stream")},3837:e=>{e.exports=require("util")},7974:(e,r,t)=>{t.r(r),t.d(r,{headerHooks:()=>f,originalPathname:()=>y,patchFetch:()=>w,requestAsyncStorage:()=>c,routeModule:()=>p,serverHooks:()=>h,staticGenerationAsyncStorage:()=>m,staticGenerationBailout:()=>g});var a={};t.r(a),t.d(a,{POST:()=>d});var s=t(5419),n=t(9108),i=t(9678),o=t(8070),u=t(2345),l=t(5665);async function d(e){try{await (0,u.Z)();let{username:r,email:t,password:a,displayName:s}=await e.json();if(!r||!t||!a)return o.Z.json({error:"Username, email, and password are required"},{status:400});if(a.length<6)return o.Z.json({error:"Password must be at least 6 characters long"},{status:400});if(!/^[a-zA-Z0-9_]+$/.test(r))return o.Z.json({error:"Username can only contain letters, numbers, and underscores"},{status:400});if(!/^\S+@\S+\.\S+$/.test(t))return o.Z.json({error:"Please provide a valid email address"},{status:400});let n=await l.Z.findOne({$or:[{email:t},{username:r}]});if(n)return o.Z.json({error:n.email===t?"Email already in use":"Username already taken"},{status:409});let i=new l.Z({username:r,email:t,password:a,displayName:s||r});await i.save();let d=i.generateAuthToken();return o.Z.json({message:"User registered successfully",user:{_id:i._id,username:i.username,email:i.email,displayName:i.displayName,bio:i.bio,avatar:i.avatar,isVerified:i.isVerified,createdAt:i.createdAt},token:d},{status:201})}catch(e){if(console.error("Registration error:",e),e instanceof Error&&e.message.includes("duplicate key"))return o.Z.json({error:"Username or email already exists"},{status:409});return o.Z.json({error:"Internal server error"},{status:500})}}let p=new s.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/auth/register/route",pathname:"/api/auth/register",filename:"route",bundlePath:"app/api/auth/register/route"},resolvedPagePath:"/Users/champi/Development/socialize/app/api/auth/register/route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:c,staticGenerationAsyncStorage:m,serverHooks:h,headerHooks:f,staticGenerationBailout:g}=p,y="/api/auth/register/route";function w(){return(0,i.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:m})}},5665:(e,r,t)=>{t.d(r,{Z:()=>d});var a=t(1185),s=t.n(a),n=t(6521),i=t.n(n),o=t(6082),u=t.n(o);let l=new(s()).Schema({username:{type:String,required:!0,unique:!0,trim:!0,minlength:3,maxlength:30,match:/^[a-zA-Z0-9_]+$/},email:{type:String,required:!0,unique:!0,lowercase:!0,trim:!0,match:/^\S+@\S+\.\S+$/},password:{type:String,required:!0,minlength:6},displayName:{type:String,required:!0,trim:!0,maxlength:50},bio:{type:String,maxlength:160,default:""},avatar:{type:String,default:null},coverImage:{type:String,default:null},followers:[{type:s().Schema.Types.ObjectId,ref:"User"}],following:[{type:s().Schema.Types.ObjectId,ref:"User"}],isVerified:{type:Boolean,default:!1},isPrivate:{type:Boolean,default:!1},createdAt:{type:Date,default:Date.now},lastActive:{type:Date,default:Date.now}});l.pre("save",async function(e){if(!this.isModified("password"))return e();try{let r=await i().genSalt(10);this.password=await i().hash(this.password,r),e()}catch(r){e(r)}}),l.methods.comparePassword=async function(e){return await i().compare(e,this.password)},l.methods.generateAuthToken=function(){let e=process.env.JWT_SECRET;if(!e)throw Error("JWT_SECRET is not defined");return u().sign({_id:this._id.toString(),username:this.username},e,{expiresIn:"30d"})},l.methods.toJSON=function(){let e=this.toObject();return delete e.password,e};let d=s().models.User||s().model("User",l)},2345:(e,r,t)=>{t.d(r,{Z:()=>o});var a=t(1185),s=t.n(a);let n=process.env.MONGODB_URI;if(!n)throw Error("Please define the MONGODB_URI environment variable inside .env.local");let i=global.mongoose;i||(i=global.mongoose={conn:null,promise:null});let o=async function(){if(i.conn)return i.conn;i.promise||(i.promise=s().connect(n,{bufferCommands:!1}).then(e=>e));try{i.conn=await i.promise}catch(e){throw i.promise=null,e}return i.conn}}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),a=r.X(0,[638,206,145],()=>t(7974));module.exports=a})();