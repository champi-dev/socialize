"use strict";(()=>{var e={};e.id=873,e.ids=[873],e.modules={1185:e=>{e.exports=require("mongoose")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},4300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},2781:e=>{e.exports=require("stream")},3837:e=>{e.exports=require("util")},4781:(e,t,r)=>{r.r(t),r.d(t,{headerHooks:()=>f,originalPathname:()=>w,patchFetch:()=>v,requestAsyncStorage:()=>c,routeModule:()=>p,serverHooks:()=>h,staticGenerationAsyncStorage:()=>m,staticGenerationBailout:()=>g});var a={};r.r(a),r.d(a,{POST:()=>d});var n=r(5419),i=r(9108),o=r(9678),s=r(8070),u=r(2345),l=r(5665);async function d(e){try{if(!process.env.MONGODB_URI)return s.Z.json({error:"Database not configured"},{status:503});await (0,u.Z)();let{login:t,password:r,email:a}=await e.json(),n=t||a;if(!n||!r)return s.Z.json({error:"Email/username and password are required"},{status:400});let i=await l.Z.findOne({$or:[{email:n},{username:n}]});if(!i||!await i.comparePassword(r))return s.Z.json({error:"Invalid credentials"},{status:401});i.lastActive=new Date,await i.save();let o=i.generateAuthToken();return s.Z.json({message:"Login successful",user:{_id:i._id,username:i.username,email:i.email,displayName:i.displayName,bio:i.bio,avatar:i.avatar,isVerified:i.isVerified,lastActive:i.lastActive},token:o},{status:200})}catch(e){return console.error("Login error:",e),s.Z.json({error:"Internal server error"},{status:500})}}let p=new n.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/auth/login/route",pathname:"/api/auth/login",filename:"route",bundlePath:"app/api/auth/login/route"},resolvedPagePath:"/Users/champi/Development/socialize/app/api/auth/login/route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:c,staticGenerationAsyncStorage:m,serverHooks:h,headerHooks:f,staticGenerationBailout:g}=p,w="/api/auth/login/route";function v(){return(0,o.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:m})}},5665:(e,t,r)=>{r.d(t,{Z:()=>d});var a=r(1185),n=r.n(a),i=r(6521),o=r.n(i),s=r(6082),u=r.n(s);let l=new(n()).Schema({username:{type:String,required:!0,unique:!0,trim:!0,minlength:3,maxlength:30,match:/^[a-zA-Z0-9_]+$/},email:{type:String,required:!0,unique:!0,lowercase:!0,trim:!0,match:/^\S+@\S+\.\S+$/},password:{type:String,required:!0,minlength:6},displayName:{type:String,required:!0,trim:!0,maxlength:50},bio:{type:String,maxlength:160,default:""},avatar:{type:String,default:null},coverImage:{type:String,default:null},followers:[{type:n().Schema.Types.ObjectId,ref:"User"}],following:[{type:n().Schema.Types.ObjectId,ref:"User"}],isVerified:{type:Boolean,default:!1},isPrivate:{type:Boolean,default:!1},createdAt:{type:Date,default:Date.now},lastActive:{type:Date,default:Date.now}});l.pre("save",async function(e){if(!this.isModified("password"))return e();try{let t=await o().genSalt(10);this.password=await o().hash(this.password,t),e()}catch(t){e(t)}}),l.methods.comparePassword=async function(e){return await o().compare(e,this.password)},l.methods.generateAuthToken=function(){let e=process.env.JWT_SECRET;if(!e)throw Error("JWT_SECRET is not defined");return u().sign({_id:this._id.toString(),username:this.username},e,{expiresIn:"30d"})},l.methods.toJSON=function(){let e=this.toObject();return delete e.password,e};let d=n().models.User||n().model("User",l)},2345:(e,t,r)=>{r.d(t,{Z:()=>s});var a=r(1185),n=r.n(a);let i=process.env.MONGODB_URI;i||console.warn("MONGODB_URI is not defined - database features will not work");let o=global.mongoose;o||(o=global.mongoose={conn:null,promise:null});let s=async function(){if(!i)throw Error("MONGODB_URI is not defined in environment variables");if(o.conn)return o.conn;o.promise||(o.promise=n().connect(i,{bufferCommands:!1}).then(e=>e));try{o.conn=await o.promise}catch(e){throw o.promise=null,e}return o.conn}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[638,206,145],()=>r(4781));module.exports=a})();